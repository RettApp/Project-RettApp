var currentFeature_or_Features=null;var watchID=null;var map,GeoMarker,activePage,geolocpoint,results,correspond,unityLabel,unityValue,agentAmount,liquidAmount,unityPerKg,patientWeight;var database=$.ajax({type:"GET",url:"xml/database.xml",dataType:"xml",async:false}).responseXML;if(localStorage.getItem("settings")===null){var settings={};settings.startdisclaimer="0";settings.meddisclaimer="0";settings.startup="0";settings.zoomrange="10";settings.poison="112";settings.vibration="0";settings.rescuecoordinationcenter="112";localStorage.setItem("settings",JSON.stringify(settings))}if(localStorage.getItem("visiblemeddisclaimer")===null){localStorage.setItem("visiblemeddisclaimer","0")}function initPositionMap(){var c=JSON.parse(localStorage.getItem("settings"));var d=+c.zoomrange;var a={zoom:d,center:new google.maps.LatLng(50.0075202,8.300264),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControl:false,};map=new google.maps.Map(document.getElementById("location-01-index-map_canvas"),a);GeoMarker=new GeolocationMarker();GeoMarker.setCircleOptions({fillColor:"#808080"});var b=navigator.geolocation.watchPosition(function(e){geolocpoint=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);map.setCenter(geolocpoint);map.setZoom(d)},function(e){console.log(typeof e=="string"?e:"error")},{maximumAge:4000,enableHighAccuracy:true});$("#stoplocation").click(function(){if($("#stoplocation").prop("checked")==false){navigator.geolocation.clearWatch(b)}else{b=navigator.geolocation.watchPosition(function(e){geolocpoint=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);map.setCenter(geolocpoint);map.setZoom(d)},function(e){console.log(typeof e=="string"?e:"error")},{maximumAge:4000,enableHighAccuracy:true})}});google.maps.event.addListenerOnce(GeoMarker,"position_changed",function(){map.setCenter(this.getPosition());map.fitBounds(this.getBounds());map.setZoom(d)});GeoMarker.setMap(map);showGeoJSON(geojson_leitstellen)}function panelAndListRefresh(){$('body > [data-role="panel"]').panel();$('body > [data-role="panel"] [data-role="listview"]').listview().listview("refresh");$('body > [data-role="page"] [data-role="listview"]').listview().listview("refresh")}function refreshSlider(a){$(a).slider().slider("refresh")}function refreshSelectMenu(a){$(a).selectmenu().selectmenu("refresh")}function changeSliderOnSettings(a,b){$(a+' [value="'+b+'"]').prop("selected",true);$(a).slider().slider("refresh")}function changeSelectMenuOnSettings(a,b){$(a+' [value="'+b+'"]').prop("selected",true);$(a).selectmenu().selectmenu("refresh")}function changeSliderVisibleOnSettings(a,b){$(a).slider(b);$(a).slider("refresh")}function changeSelectMenuVisibleOnSettings(a,b){$(a).selectmenu(b);$(a).selectmenu("refresh")}function openDeviceBrowser(a){window.open(a,"_system","location=no")}function showGeoJSON(b,d){currentFeature_or_Features=new GeoJSON(b,d||null);if(currentFeature_or_Features.type&&currentFeature_or_Features.type=="Error"){document.getElementById("putsomthing").value=currentFeature_or_Features.message;return}if(currentFeature_or_Features.length){for(var c=0;c<currentFeature_or_Features.length;c++){if(currentFeature_or_Features[c].length){for(var a=0;a<currentFeature_or_Features[c].length;a++){currentFeature_or_Features[c][a].setMap(map);if(currentFeature_or_Features[c][a].geojsonProperties){setInfoWindow(currentFeature_or_Features[c][a])}}}else{currentFeature_or_Features[c].setMap(map)}if(currentFeature_or_Features[c].geojsonProperties){setInfoWindow(currentFeature_or_Features[c])}}}else{currentFeature_or_Features.setMap(map);if(currentFeature_or_Features.geojsonProperties){setInfoWindow(currentFeature_or_Features)}}}function setInfoWindow(a){google.maps.event.addListener(a,"click",function(d){var c="<b>Aktuelle Leitstelle:</b>";for(var b in this.geojsonProperties){if(b!="Telefon"){c+="<br />"+b+": "+this.geojsonProperties[b]}}c+='<p><a href="tel:'+this.geojsonProperties.Telefon+'" class="ui-btn ui-icon-phone ui-btn-icon-left ui-corner-all">Diese Anrufen</a></p>';$("#location-01-map_canvas_info").html(c)})}function restoreOrder(h,r,c,k){var m=$(h);if(m==null){return}var f=localStorage.getItem(r);if(!f){return}var e=f.split(",");var o=m.sortable("toArray",{attribute:"name"});var p=new Array();console.log(o.length);for(var q=0,j=o.length;q<j;q++){p[o[q]]=o[q]}console.log(e.length);for(var g=0,d=e.length;g<d;g++){var a=e[g];if(a in p){var s=p[a];var b=m.children("[name='"+s+"']");var l=m.children("[name='"+a+"']");b.remove();m.filter(":first").append(l)}}switch(c){case"collapsibleset":m.collapsibleset("refresh");break;case"listview":m.listview("refresh");break}if(k==true){m.sortable("disable")}}$(document).on("pagebeforecreate","#main-01-disclaimer",function(b,c){var a=JSON.parse(localStorage.getItem("settings"));if(a.startdisclaimer=="1"){if(a.startup=="1"){$.mobile.changePage("#main-02-index")}else{$.mobile.changePage("#main-03-startup")}}panelAndListRefresh()});$(document).on("pageshow","#location-01-index",function(){initPositionMap()});$(document).on("pagebeforeshow","#function-02-settings",function(b){panelAndListRefresh();var a=JSON.parse(localStorage.getItem("settings"));if(localStorage.getItem("visiblemeddisclaimer")=="0"){changeSliderVisibleOnSettings("#settings-meddisclaimer","disable")}else{changeSliderVisibleOnSettings("#settings-meddisclaimer","enable")}if(a.position=="1"){changeSelectMenuVisibleOnSettings("#settings-zoomrange","disable")}else{changeSelectMenuVisibleOnSettings("#settings-zoomrange","enable")}changeSliderOnSettings("#settings-startdisclaimer",a.startdisclaimer);changeSliderOnSettings("#settings-startup",a.startup);changeSliderOnSettings("#settings-meddisclaimer",a.meddisclaimer);changeSliderOnSettings("#settings-position",a.position);changeSelectMenuOnSettings("#settings-zoomrange",a.zoomrange);changeSelectMenuOnSettings("#settings-poison",a.poison);changeSelectMenuOnSettings("#settings-rescuecoordinationcenter",a.rescuecoordinationcenter)});$(document).on("pagebeforeshow","#main-03-startup",function(b){var a=JSON.parse(localStorage.getItem("settings"));if(a.startup=="1"){$.mobile.changePage("#main-02-index")}panelAndListRefresh()});$(document).on("pagebeforeshow","#main-02-index",function(a){panelAndListRefresh()});$(document).on("pageshow","#main-03-startup",function(a){$("#slides").slidesjs({width:700,height:700,navigation:false})});$(document).on("pagebeforeshow",function(b){var a=JSON.parse(localStorage.getItem("settings"));if(a.meddisclaimer=="1"){var c=$("a.drugsDisclaimer");$.each(c,function(){$(this).attr("href","#drugs-02-index")})}else{var c=$("a.drugsDisclaimer");$.each(c,function(){$(this).attr("href","#drugs-01-disclaimer")})}if(a.startup=="1"){var c=$("a.startuplink");$.each(c,function(){$(this).attr("href","#main-02-index")})}else{var c=$("a.startuplink");$.each(c,function(){$(this).attr("href","#main-03-startup")})}});$(document).on("pagebeforeshow",function(a){activePage=$.mobile.activePage.attr("id");$("a.ui-btn-active").removeClass("ui-btn-active");$('[href="#'+activePage+'"]').addClass("ui-btn-active")});$(document).on("pageshow",function(b){var a=JSON.parse(localStorage.getItem("settings"));$(".getPoisonNumber").attr("href","tel:"+a.poison);$(".getRescueCoordinationCenterNumber").attr("href","tel:"+a.rescuecoordinationcenter)});$(document).on("pageshow","#function-03-dose",function(a){$("input").change(function(){unityLabel=$("#unity :radio:checked").attr("label");unityValue=$("#unity :radio:checked").val();agentAmount=$("#agent-amount").val();liquidAmount=$("#liquid-amount").val();unityPerKg=$("#unity-per-kg").val();patientWeight=$("#patient-weight").val();if(unityValue==="1"){results="<b>"+agentAmount+unityLabel+" auf "+liquidAmount+" ml</b><br>";results+=agentAmount*1000+"mg auf "+liquidAmount+" ml<br>";results+=agentAmount*1000000+"µg auf "+liquidAmount+" ml";$("#doseResultsConditionDefinition").html(results)}else{if(unityValue==="1000"){results=agentAmount/1000+"g auf "+liquidAmount+" ml</b><br>";results+="<b>"+agentAmount+unityLabel+" auf "+liquidAmount+" ml</b><br>";results+=agentAmount*1000+"µg auf "+liquidAmount+" ml";$("#doseResultsConditionDefinition").html(results)}else{if(unityValue==="1000000"){results=agentAmount/1000000+"g auf "+liquidAmount+" ml</b><br>";results+=agentAmount/1000+"mg auf "+liquidAmount+" ml<br>";results+="<b>"+agentAmount+unityLabel+" auf "+liquidAmount+" ml<b>";$("#doseResultsConditionDefinition").html(results)}}}if(unityValue==="1"){results="<b>"+agentAmount/liquidAmount+" "+unityLabel+"/ml</b><br>";results+=agentAmount*1000/liquidAmount+" mg/ml<br>";results+=agentAmount*1000000/liquidAmount+" µg/ml";$("#doseResultsCorrespondValue").html(results)}else{if(unityValue==="1000"){results=agentAmount/1000/liquidAmount+" g/ml<br>";results+="<b>"+agentAmount/liquidAmount+" "+unityLabel+"/ml</b><br>";results+=agentAmount*1000/liquidAmount+" µg/ml";$("#doseResultsCorrespondValue").html(results)}else{if(unityValue==="1000000"){results=agentAmount/1000000/liquidAmount+" g/ml<br>";results+=agentAmount/1000/liquidAmount+" mg/ml<br>";results+="<b>"+agentAmount/liquidAmount+" "+unityLabel+"/ml</b>";$("#doseResultsCorrespondValue").html(results)}}}if(unityValue==="1"){correspond=agentAmount*1000/liquidAmount;results=patientWeight*unityPerKg+" mg<br>";results+=patientWeight*unityPerKg/correspond+" ml bei aktueller Dosis";$("#doseResultsDoseValue").html(results)}else{if(unityValue==="1000"){correspond=agentAmount/liquidAmount;results=patientWeight*unityPerKg+" mg<br>";results+=patientWeight*unityPerKg/correspond+" ml bei aktueller Dosis";$("#doseResultsDoseValue").html(results)}else{if(unityValue==="1000000"){correspond=agentAmount/1000/liquidAmount;results=patientWeight*unityPerKg+" mg<br>";results+=patientWeight*unityPerKg/correspond+" ml bei aktueller Dosis";$("#doseResultsDoseValue").html(results)}}}})});$(document).on("pageshow",function(a){$("#saveSettings").click(function(){var b={};b.startdisclaimer=$("#settings-startdisclaimer").val();b.meddisclaimer=$("#settings-meddisclaimer").val();b.startup=$("#settings-startup").val();b.zoomrange=$("#settings-zoomrange").val();b.poison=$("#settings-poison").val();b.rescuecoordinationcenter=$("#settings-rescuecoordinationcenter").val();localStorage.setItem("settings",JSON.stringify(b));location.reload(true)});$("#setVisibleMedSetting").click(function(){if(localStorage.getItem("visiblemeddisclaimer")=="0"){localStorage.setItem("visiblemeddisclaimer","1")}})});$(document).on("pagebeforeshow","#function-02-settings-sort",function(a){$("#settings-medisort").sortable({containment:"parent",opacity:0.6,update:function(b,c){$("#settings-medisort").listview("refresh");orderToSave=$("#settings-medisort").sortable("toArray",{attribute:"name"});console.log(orderToSave);localStorage.setItem("sortMedical",orderToSave)}});restoreOrder("#settings-medisort","sortMedical","listview",false)});$(document).on("pagebeforeshow",".sortDrugList",function(a){$(".listToSort").sortable();restoreOrder(".listToSort","sortMedical","collapsibleset",true);$(".listToSort").sortable("disable")});$(document).on("click",".show-page-loading-msg",function(){var d=$(this),c=d.jqmData("theme")||$.mobile.loader.prototype.options.theme,a=d.jqmData("msgtext")||$.mobile.loader.prototype.options.text,b=d.jqmData("textvisible")||$.mobile.loader.prototype.options.textVisible,e=!!d.jqmData("textonly");html=d.jqmData("html")||"";$.mobile.loading("show",{text:a,textVisible:b,theme:c,textonly:e,html:html})}).on("click",".hide-page-loading-msg",function(){$.mobile.loading("hide")});